# lanFileSharer

一个用于在局域网设备间直接共享文件的工具。

## 工作原理

连接过程设计为健壮且高效，结合了直接IP通信和mDNS主机名解析的灵活性。它分为两个主要阶段：

### 阶段1：发现和初始握手(DNS-SD + HTTP)

1.  **服务发现**：当接收端应用启动时，它会通过mDNS/DNS-SD在局域网广播其存在。
2.  **IP解析**：发送端应用通过此广播发现接收端，并将其`.local`主机名解析为具体IP地址(如`192.168.1.55`)。
3.  **HTTP握手**：发送端随后使用发现的IP地址与接收端建立直接HTTP连接。此连接用作主要信令通道，用于交换基本元数据，如要传输的文件结构和初始WebRTC会话信息(SDP Offer/Answer)。

### 阶段2：高速数据传输(WebRTC)

1.  **PeerConnection建立**：握手完成后，双方设备继续建立WebRTC `PeerConnection`。
2.  **P2P传输**：此连接用于实际高速、点对点的文件数据传输，利用WebRTC数据通道的性能。

### 通过`SetMulticastDNSMode`实现的健壮性

为了使连接过程对IP地址变更(如DHCP租约更新)具有弹性，底层WebRTC `SettingEngine`配置了`MulticastDNSModeEnabled`。

-   **功能**：此设置使WebRTC中的ICE代理能够在连接检查阶段直接解析`.local`主机名。
-   **重要性**：虽然初始连接使用预解析的IP，但ICE协商包含带有`.local`主机名的候选。如果初始IP已失效，ICE代理可以使用mDNS重新解析主机名为设备当前IP地址。这作为一个强大的回退机制，确保仍能建立连接，使应用显著更健壮。

这种双重方法利用直接IP通信的速度进行初始握手，同时保留mDNS的灵活性和弹性用于底层P2P数据连接。
